<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>The dependency solver — pkg_solution • pkgdepends</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The dependency solver — pkg_solution"><meta name="description" content="The dependency solver takes the resolution information, and works out
the exact versions of each package that must be installed, such that
version and other requirements are satisfied."><meta property="og:description" content="The dependency solver takes the resolution information, and works out
the exact versions of each package that must be installed, such that
version and other requirements are satisfied."><meta name="robots" content="noindex"><script defer data-domain="https://r-lib.github.io/pkgdepends,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pkgdepends</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.9.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pkgdepends-how-to.html">How-to</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/pkgdepends/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The dependency solver</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/pkgdepends/blob/main/R/solve.R" class="external-link"><code>R/solve.R</code></a></small>
      <div class="d-none name"><code>pkg_solution.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The dependency solver takes the resolution information, and works out
the exact versions of each package that must be installed, such that
version and other requirements are satisfied.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="solution-policies">Solution policies<a class="anchor" aria-label="anchor" href="#solution-policies"></a></h3>


<p>The dependency solver currently supports two policies: <code>lazy</code> and
<code>upgrade</code>. The <code>lazy</code> policy prefers to minimize installation time,
and it does not perform package upgrades, unless version requirements
require them. The <code>upgrade</code> policy prefers to update all package to
their latest possible versions, but it still considers that version
requirements.</p>
</div>

<div class="section">
<h3 id="the-integer-problem">The integer problem<a class="anchor" aria-label="anchor" href="#the-integer-problem"></a></h3>


<p>Solving the package dependencies requires solving an integer linear
problem (ILP). This subsection briefly describes how the problem is
represented as an integer problem, and what the solution policies
exactly mean.</p>
<p>Every row of the package resolution is a candidate for the dependency
solver. In the integer problem, every candidate corresponds to a binary
variable. This is 1 if that candidate is selected as part of the
solution, and 0 otherwise.</p>
<p>The objective of the ILP minimization is defined differently for
different solution policies. The ILP conditions are the same.</p><ol><li><p>For the <code>lazy</code> policy, <code>installed::</code> packaged get 0 points, binary
packages 1 point, sources packages 5 points.</p></li>
<li><p>For the 'upgrade' policy, we rank all candidates for a given package
according to their version numbers, and assign more points to older
versions. Points are assigned by 100 and candidates with equal
versions get equal points. We still prefer installed packages to
binaries to source packages, so also add 0 point for already
installed candidates, 1 extra points for binaries and 5 points for
source packages.</p></li>
<li><p>For directly specified refs, we aim to install each package exactly
once. So for these we require that the variables corresponding to
the same package sum up to 1.</p></li>
<li><p>For non-direct refs (i.e. dependencies), we require that the
variables corresponding to the same package sum up to at most one.
Since every candidate has at least 1 point in the objective function
of the minimization problem, non-needed dependencies will be
omitted.</p></li>
<li><p>For direct refs, we require that their candidates satisfy their
references. What this means exactly depends on the ref types. E.g.
for CRAN packages, it means that a CRAN candidate must be selected.
For a standard ref, a GitHub candidate is OK as well.</p></li>
<li><p>We rule out candidates for which the dependency resolution failed.</p></li>
<li><p>We go over all the dependency requirements and rule out packages
that do not meet them. For every package <code>A</code>, that requires
package <code>B</code>, we select the <code>B(i, i=1..k)</code> candidates of <code>B</code> that
satisfy <code>A</code>'s requirements and add a <code>A - B(1) - ... - B(k) &lt;= 0</code>
rule. To satisfy this rule, either we cannot install <code>A</code>, or if <code>A</code>
is installed, then one of the good <code>B</code> candidates must be installed
as well.</p></li>
<li><p>We rule out non-installed CRAN and Bioconductor candidates for
packages that have an already installed candidate with the same exact
version.</p></li>
<li><p>We also rule out source CRAN and Bioconductor candidates for
packages that have a binary candidate with the same exact version.</p></li>
</ol></div>

<div class="section">
<h3 id="explaining-why-the-solver-failed">Explaining why the solver failed<a class="anchor" aria-label="anchor" href="#explaining-why-the-solver-failed"></a></h3>


<p>To be able to explain why a solution attempt failed, we also add a dummy
variable for each directly required package. This dummy variable has a
very large objective value, and it is only selected if there is no
way to install the directly required package.</p>
<p>After a failed solution, we look the dummy variables that were selected,
to see which directly required package failed to solve. Then we check
which rule(s) ruled out the installation of these packages, and their
dependencies, recursively.</p>
</div>

<div class="section">
<h3 id="the-result">The result<a class="anchor" aria-label="anchor" href="#the-result"></a></h3>


<p>The result of the solution is a <code>pkg_solution_result</code> object. It is a
named list with entries:</p><ul><li><p><code>status</code>: Status of the solution attempt, <code>"OK"</code> or <code>"FAILED"</code>.</p></li>
<li><p><code>data</code>: The selected candidates. This is very similar to a
<a href="pkg_resolution.html">pkg_resolution_result</a> object, but it has two extra columns:</p><ul><li><p><code>lib_status</code>: status of the package in the library, after the
installation. Possible values: <code>new</code> (will be newly installed),
<code>current</code> (up to date, not installed), <code>update</code> (will be updated),
<code>no-update</code> (could update, but will not).</p></li>
<li><p><code>old_version</code>: The old (current) version of the package in the
library, or <code>NA</code> if the package is currently not installed.</p></li>
</ul></li>
<li><p><code>problem</code>: The ILP problem. The exact representation is an
implementation detail, but it does have an informative print method.</p></li>
<li><p><code>solution</code>: The return value of the internal solver.</p></li>
</ul></div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer></body></html>

